{% for product in products %}
<div class="product-card">
    <div class="product-image">
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.title }}" class="dynamic-image">
        {% else %}
        <div style="background: #f0f0f0; height: 200px; display: flex; align-items: center; justify-content: center;">
            <span>No Image</span>
        </div>
        {% endif %}
    </div>
    <div class="product-info">
        <h3 class="product-name">{{ product.title }}</h3>
        <p class="product-description">{{ product.description|truncatewords:15 }}</p>
        <div class="product-price">${{ product.price }}</div>

        {% if user.is_authenticated %}
        <button class="add-to-cart-btn" data-product-id="{{ product.id }}"
            data-product-name="{{ product.title }}" data-product-price="{{ product.price }}"
            data-product-image="{% if product.image %}{{ product.image.url }}{% endif %}">
            <i class="fas fa-shopping-cart"></i> Add to Cart
        </button>
        {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}" class="login-to-cart-btn">
            <i class="fas fa-sign-in-alt"></i> Login to Add to Cart
        </a>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="no-products">
    <p>{% if query %}No products found for "{{ query }}".{% else %}No products available at the moment.{% endif %}</p>
</div>
{% endfor %}
